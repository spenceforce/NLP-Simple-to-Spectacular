<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; OneR – NLP: From Simple to Spectacular</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapter/04_boc/boc.html" rel="next">
<link href="../../chapter/02_baseline/baseline_classifier.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-72c93205fb41c15e2e398b4f9a505ee2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapter/03_oner/oner.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">OneR</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">NLP: From Simple to Spectacular</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/01_data/data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Machine learning needs data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/02_baseline/baseline_classifier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Baseline: gotta start somewhere</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/03_oner/oner.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">OneR</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/04_boc/boc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">OneR, TwoR, RedR, BlueR: Inputs matter</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/05_decision_tree/decision_tree.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">More rules with Decision Trees</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/bonus/cleaning_data/cleaning_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Bonus: cleaning data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapter/bonus/quality_vs_quantity/quality_vs_quantity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Bonus: quality vs.&nbsp;quantity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-oner-algorithm" id="toc-the-oner-algorithm" class="nav-link active" data-scroll-target="#the-oner-algorithm"><span class="header-section-number">3.1</span> The OneR algorithm</a>
  <ul class="collapse">
  <li><a href="#discrete-features" id="toc-discrete-features" class="nav-link" data-scroll-target="#discrete-features"><span class="header-section-number">3.1.1</span> Discrete features</a></li>
  </ul></li>
  <li><a href="#rolling-our-own" id="toc-rolling-our-own" class="nav-link" data-scroll-target="#rolling-our-own"><span class="header-section-number">3.2</span> Rolling our own</a></li>
  <li><a href="#sec-feature-extraction-intro" id="toc-sec-feature-extraction-intro" class="nav-link" data-scroll-target="#sec-feature-extraction-intro"><span class="header-section-number">3.3</span> Feature extraction</a>
  <ul class="collapse">
  <li><a href="#data-analysis-side-quest" id="toc-data-analysis-side-quest" class="nav-link" data-scroll-target="#data-analysis-side-quest"><span class="header-section-number">3.3.1</span> Data analysis side quest</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">OneR</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Moving beyond the <a href="../../chapter/02_baseline/baseline_classifier.html">simplest model</a>, the next step is a deep neural network. Just kidding, the next step is something slightly more complex but still very simple. OneR <span class="citation" data-cites="Holte1993">(<a href="../../references.html#ref-Holte1993" role="doc-biblioref">Holte 1993</a>)</span> is such a model. Last time we trained a baseline model, now we aim to beat it.</p>
<div id="ee5011c7-9395-4a8a-8baf-8174d495a099" class="cell" data-execution_count="1">
<div class="cell-output cell-output-display" data-execution_count="1">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Accuracy</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Model</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Baseline</td>
<td>0.501119</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="margin-aside">For reference, here’s a table showing the accuracy we achieved last chapter.</span></div></div>
<section id="the-oner-algorithm" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="the-oner-algorithm"><span class="header-section-number">3.1</span> The OneR algorithm</h2>
<p>OneR, short for One Rule, works on the sampe principle as the baseline model, but instead of returning the most frequent label in the whole dataset it returns the most frequent label for that feature value. The caveat is that value must be discrete.</p>
<section id="discrete-features" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="discrete-features"><span class="header-section-number">3.1.1</span> Discrete features</h3>
<p>Think integers or strings. These are countable values. Discrete values can be unordered, like in movie genres where there is horror, comedy, action, etc. They can be ordered as well, like the number of leaves on a tree; the higher the number the more leaves. Any value that is on a continuous scale is not discrete, like any number between 0 and 1. There is an infinite number of values between 0 and 1, which isn’t countable, so it’s not discrete. But if the value can only be 0 <em>or</em> 1 then that is discrete because there’s only 2 values.</p>
</section>
</section>
<section id="rolling-our-own" class="level2 page-columns page-full" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="rolling-our-own"><span class="header-section-number">3.2</span> Rolling our own</h2>
<div class="page-columns page-full"><p>We can treat our movie reviews as discrete values where each unique review is a unique value.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">There is no easy button for this model, so we’ll go straight to implementing it ourselves.</span></div></div>
<div id="e283182d-bf27-4cf4-9709-9052458f4f67" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">from</span> sklearn.dummy <span class="im">import</span> DummyClassifier</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">from</span> nlpbook <span class="im">import</span> get_train_test_data</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co"># Grab the data and set it up for training.</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>train_df, test_df <span class="op">=</span> get_train_test_data()</span>
<span id="cb1-8"><a href="#cb1-8"></a>features <span class="op">=</span> <span class="st">"review"</span></span>
<span id="cb1-9"><a href="#cb1-9"></a>label <span class="op">=</span> <span class="st">"label"</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># `X` is an array here instead of a matrix.</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># We are training on one feature, so we are jumping</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># straight to working on an array for simplicity.</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>X, y <span class="op">=</span> train_df[features], train_df[label]</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>predictors <span class="op">=</span> {}</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co"># Iterate over each unique review.</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="cf">for</span> value <span class="kw">in</span> np.unique(X):</span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="co"># Create a boolean array where `True` indices indicate the rows</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>    <span class="co"># in `X` that have that value.</span></span>
<span id="cb1-20"><a href="#cb1-20"></a>    is_value <span class="op">=</span> X <span class="op">==</span> value</span>
<span id="cb1-21"><a href="#cb1-21"></a>    <span class="co"># Use the boolean array to index into `X` and `y`, keeping</span></span>
<span id="cb1-22"><a href="#cb1-22"></a>    <span class="co"># the rows where the input is `value`.</span></span>
<span id="cb1-23"><a href="#cb1-23"></a>    _X <span class="op">=</span> X[is_value]</span>
<span id="cb1-24"><a href="#cb1-24"></a>    _y <span class="op">=</span> y[is_value]</span>
<span id="cb1-25"><a href="#cb1-25"></a>    <span class="co"># Train a baseline classifier on the subset of the dataset</span></span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="co"># for this value.</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>    predictors[value] <span class="op">=</span> DummyClassifier().fit(_X, _y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have a bunch of predictors, each trained on a unique review. Let’s see how it performs on the test set.</p>
<div id="f2472fc3-dd53-4809-b247-43e2f4674a80" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># Remember do to the test set as you do to the train set.</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>X_test, y_test <span class="op">=</span> test_df[features], test_df[label]</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># We need an array the same length as the test set for the</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co"># predictions.</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>pred <span class="op">=</span> np.zeros(<span class="bu">len</span>(X_test), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># Iterate over each unique review.</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="cf">for</span> value <span class="kw">in</span> np.unique(X_test):</span>
<span id="cb2-12"><a href="#cb2-12"></a>    is_value <span class="op">=</span> X_test <span class="op">==</span> value</span>
<span id="cb2-13"><a href="#cb2-13"></a>    <span class="co"># We only need the inputs, so just index into `X_test`.</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>    _X <span class="op">=</span> X_test[is_value]</span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="co"># Fill the `pred` array with the predictions for this</span></span>
<span id="cb2-16"><a href="#cb2-16"></a>    <span class="co"># value.</span></span>
<span id="cb2-17"><a href="#cb2-17"></a>    pred[is_value] <span class="op">=</span> predictors[value].predict(_X)</span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co"># Evaluate the prediction accuracy.</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>accuracy_score(y_test, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[3], line 17</span>
<span class="ansi-green-fg ansi-bold">     14</span>     _X <span style="color:rgb(98,98,98)">=</span> X_test[is_value]
<span class="ansi-green-fg ansi-bold">     15</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Fill the `pred` array with the predictions for this</span>
<span class="ansi-green-fg ansi-bold">     16</span>     <span style="font-style:italic;color:rgb(95,135,135)"># value.</span>
<span class="ansi-green-fg">---&gt; 17</span>     pred[is_value] <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">predictors</span><span class="ansi-yellow-bg">[</span><span class="ansi-yellow-bg">value</span><span class="ansi-yellow-bg">]</span><span style="color:rgb(98,98,98)">.</span>predict(_X)
<span class="ansi-green-fg ansi-bold">     19</span> <span style="font-style:italic;color:rgb(95,135,135)"># Evaluate the prediction accuracy.</span>
<span class="ansi-green-fg ansi-bold">     20</span> accuracy_score(y_test, pred)

<span class="ansi-red-fg">KeyError</span>: "!!! Spoiler alert!!!&lt;br /&gt;&lt;br /&gt;The point is, though, that I didn't think this film had an ending TO spoil... I only started watching it in the middle, after Matt had gotten into Sarah's body, but then I became fascinated by the bizarreness of the plot, even for a Channel 5 movie... and couldn't possibly see how Matt wld end up happy. What about his fiancee? At one stage looked like he was gonna get with his best friend, surely icky and wrong... and then the whole 'oggi oggi oggi' thing does NOT WORK as a touching buddy-buddy catchphrase, tis just ridiculous... so was going 'surely he can't just come back to life? and yet how can he live as a woman?' and then the film just got over that by ending and not explaining anything at all!!!!! What's that about??? I was so cross, wasted a whole hour of my life for no reason at all!!! :) but was one of the funniest films I've ever seen, so, swings and roundabouts"</pre>
</div>
</div>
</div>
<p><em>*Surprised pikachu face*</em> An error!? Well actually that’s not surprising since the reviews in the test set are different from those in the train set, so we can’t look up a review in the <code>predictors</code> dict we didn’t train a predictor for. We can pivot and use a fallback predictor for unseen reviews.</p>
<div id="1a2a83c5-69d8-4259-9cb7-a18896cfe090" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create a fallback baseline model for unknown categories.</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>fallback <span class="op">=</span> DummyClassifier().fit(X, y)</span>
<span id="cb3-3"><a href="#cb3-3"></a></span>
<span id="cb3-4"><a href="#cb3-4"></a><span class="co"># We need an array the same length as the test set for the</span></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># predictions.</span></span>
<span id="cb3-6"><a href="#cb3-6"></a>pred <span class="op">=</span> np.zeros(<span class="bu">len</span>(X_test), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="co"># Iterate over each unique review.</span></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="cf">for</span> value <span class="kw">in</span> np.unique(X_test):</span>
<span id="cb3-9"><a href="#cb3-9"></a>    is_value <span class="op">=</span> X_test <span class="op">==</span> value</span>
<span id="cb3-10"><a href="#cb3-10"></a>    <span class="co"># We only need the inputs, so just index into `X_test`.</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>    _X <span class="op">=</span> X_test[is_value]</span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="co"># Fill the `pred` array with the predictions for this</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="co"># value.</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>    <span class="cf">try</span>:</span>
<span id="cb3-15"><a href="#cb3-15"></a>        pred[is_value] <span class="op">=</span> predictors[value].predict(_X)</span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb3-17"><a href="#cb3-17"></a>        pred[is_value] <span class="op">=</span> fallback.predict(_X)</span>
<span id="cb3-18"><a href="#cb3-18"></a></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co"># Evaluate the prediction accuracy.</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>accuracy_score(y_test, pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0.5011190233977619</code></pre>
</div>
</div>
<p>Crap, this is the same accuracy as the baseline, and that’s because <em>every</em> review in the test set is different from those in the train set, so the fallback model will be used to predict every review. Since the fallback model is the baseline we end up with the same result.</p>
<p>Where do we go from here?</p>
</section>
<section id="sec-feature-extraction-intro" class="level2 page-columns page-full" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-feature-extraction-intro"><span class="header-section-number">3.3</span> Feature extraction</h2>
<p>With our current setup, the only way to compare two reviews is to see if they are the same review or not. But two pieces of text contain much richer information that can be used to compare them. Letters make up words, words make up sentences, sentences make up paragraphs, and so on. Language also has syntax and semantics. As machine learning practitioners we actually don’t care about syntax and semantics. We expect our models will learn the concepts they need as they train on the target task. We do care about how the text is represented as this is what our models learn from.</p>
<p>Feature extraction is a way to convert data into a format that is useable by machine learning models. Data that is numeric, like scientific measurements, are machine learning friendly by default, but text and image data is not. These types of data need to be converted to numbers in a way that preserves their information. As always, let’s start simple. We can extract the length of the review and use that as a feature.</p>
<div id="93a5b4c5-9cd1-491a-8bb8-6b18875f0900" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>train_df[<span class="st">"length"</span>] <span class="op">=</span> train_df[<span class="st">"review"</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb5-2"><a href="#cb5-2"></a>train_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">movie_id</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">review</th>
<th data-quarto-table-cell-role="th">label</th>
<th data-quarto-table-cell-role="th">length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>7275</td>
<td>tt0082799</td>
<td>1</td>
<td>"National Lampoon Goes to the Movies" (1981) i...</td>
<td>0</td>
<td>1672</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1438</td>
<td>tt0397501</td>
<td>4</td>
<td>Well! What can one say? Firstly, this adaptati...</td>
<td>0</td>
<td>1659</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>9137</td>
<td>tt0364986</td>
<td>1</td>
<td>What can I say, this is a piece of brilliant f...</td>
<td>0</td>
<td>1556</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>173</td>
<td>tt0283974</td>
<td>3</td>
<td>A decent sequel, but does not pack the punch o...</td>
<td>0</td>
<td>481</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>8290</td>
<td>tt0314630</td>
<td>2</td>
<td>Alan Rudolph is a so-so director, without that...</td>
<td>0</td>
<td>1306</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="data-analysis-side-quest" class="level3 page-columns page-full" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="data-analysis-side-quest"><span class="header-section-number">3.3.1</span> Data analysis side quest</h3>
<div class="page-columns page-full"><p>We will train a model on the <code>length</code> feature, but before we do let’s take a second to inspect it and see if we can make any assumptions based on what we see. A histogram is a fitting place to start with this data.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><a href="https://en.wikipedia.org/wiki/Histogram">Histograms</a> are a way to visualize value counts.</span></div></div>
<div id="33af68f1-827e-40c4-b61c-90430eeeac58" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>sns.displot(train_df, x<span class="op">=</span><span class="st">"length"</span>, hue<span class="op">=</span><span class="st">"label"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="oner_files/figure-html/cell-7-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The x-axis shows the unique <code>length</code> values in our data set, the y-axis is the number of times that length shows up, and the color is the label. The vast majority of reviews are under 2,000 characters. There are almost no reviews over 6,000 characters. There are two distinct peaks on the left side of the graph, let’s zoom in on those.</p>
<div id="9c23d45a-7a61-4b34-a548-a29f18537885" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>sns.displot(</span>
<span id="cb7-2"><a href="#cb7-2"></a>    train_df[train_df[<span class="st">"length"</span>] <span class="op">&lt;</span> <span class="dv">2000</span>], x<span class="op">=</span><span class="st">"length"</span>, hue<span class="op">=</span><span class="st">"label"</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="oner_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The first peak is between 250 and 500. We see a higher number of positive labels (orange) here, so if we made a prediction in this area it should probably be positive. The next peak is around 750. There is a higher number of negative labels (blue), so a negative prediction is called for here. The difference between negative and positive labels is slight though, so it’s hard to expect our predictions to be accurate. That shouldn’t stop us from trying though!</p>
<p>Let’s scikit-learnify our model and see how it does on the <code>length</code> feature.</p>
<div id="24981e93-c38a-4edc-9940-42249d22be47" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a><span class="im">from</span> sklearn.base <span class="im">import</span> BaseEstimator, ClassifierMixin</span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="im">from</span> sklearn.utils.multiclass <span class="im">import</span> unique_labels</span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a></span>
<span id="cb8-5"><a href="#cb8-5"></a><span class="kw">class</span> OneR(ClassifierMixin, BaseEstimator):</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, X, y):</span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="co">"""Train on the categories in the first column of `X`."""</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>        <span class="co"># Store the classes.</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>        <span class="co"># sklearn provides a handy function `unique_labels` for this</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>        <span class="co"># purpose. You could also use `np.unique`.</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>        <span class="va">self</span>.classes_ <span class="op">=</span> unique_labels(y)</span>
<span id="cb8-12"><a href="#cb8-12"></a></span>
<span id="cb8-13"><a href="#cb8-13"></a>        predictors <span class="op">=</span> {}</span>
<span id="cb8-14"><a href="#cb8-14"></a>        <span class="co"># Get the unique categories from `X`.</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>        categories <span class="op">=</span> np.unique(X)</span>
<span id="cb8-16"><a href="#cb8-16"></a>        <span class="cf">for</span> value <span class="kw">in</span> categories:</span>
<span id="cb8-17"><a href="#cb8-17"></a>            <span class="co"># Create a boolean array where `True` indices indicate the</span></span>
<span id="cb8-18"><a href="#cb8-18"></a>            <span class="co"># rows that have this value.</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>            is_value <span class="op">=</span> X <span class="op">==</span> value</span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a>            <span class="co"># Grab all data points and labels with this value.</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>            _X <span class="op">=</span> X[is_value]</span>
<span id="cb8-23"><a href="#cb8-23"></a>            _y <span class="op">=</span> y[is_value]</span>
<span id="cb8-24"><a href="#cb8-24"></a></span>
<span id="cb8-25"><a href="#cb8-25"></a>            <span class="co"># Train a baseline classifier on the value.</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>            predictors[value] <span class="op">=</span> DummyClassifier().fit(_X, _y)</span>
<span id="cb8-27"><a href="#cb8-27"></a></span>
<span id="cb8-28"><a href="#cb8-28"></a>        <span class="va">self</span>.predictors_ <span class="op">=</span> predictors</span>
<span id="cb8-29"><a href="#cb8-29"></a></span>
<span id="cb8-30"><a href="#cb8-30"></a>        <span class="co"># Create a fallback predictor for unknown categories.</span></span>
<span id="cb8-31"><a href="#cb8-31"></a>        <span class="va">self</span>.unknown_predictor_ <span class="op">=</span> DummyClassifier().fit(X, y)</span>
<span id="cb8-32"><a href="#cb8-32"></a>        <span class="cf">return</span> <span class="va">self</span></span>
<span id="cb8-33"><a href="#cb8-33"></a></span>
<span id="cb8-34"><a href="#cb8-34"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, X):</span>
<span id="cb8-35"><a href="#cb8-35"></a>        <span class="co">"""Predict the labels for inputs `X`."""</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>        <span class="co"># Create an empty array that will hold the predictions.</span></span>
<span id="cb8-37"><a href="#cb8-37"></a>        rv <span class="op">=</span> np.zeros(<span class="bu">len</span>(X), dtype<span class="op">=</span><span class="bu">int</span>)</span>
<span id="cb8-38"><a href="#cb8-38"></a></span>
<span id="cb8-39"><a href="#cb8-39"></a>        <span class="co"># Get the unique categories from `X`.</span></span>
<span id="cb8-40"><a href="#cb8-40"></a>        categories <span class="op">=</span> np.unique(X)</span>
<span id="cb8-41"><a href="#cb8-41"></a>        <span class="cf">for</span> value <span class="kw">in</span> categories:</span>
<span id="cb8-42"><a href="#cb8-42"></a>            <span class="co"># Create a boolean array where `True` indices indicate the</span></span>
<span id="cb8-43"><a href="#cb8-43"></a>            <span class="co"># rows that have this value.</span></span>
<span id="cb8-44"><a href="#cb8-44"></a>            is_value <span class="op">=</span> X <span class="op">==</span> value</span>
<span id="cb8-45"><a href="#cb8-45"></a></span>
<span id="cb8-46"><a href="#cb8-46"></a>            <span class="co"># Grab all data points in this value.</span></span>
<span id="cb8-47"><a href="#cb8-47"></a>            _X <span class="op">=</span> X[is_value]</span>
<span id="cb8-48"><a href="#cb8-48"></a></span>
<span id="cb8-49"><a href="#cb8-49"></a>            <span class="co"># Predict the label for all datapoints in `_X`.</span></span>
<span id="cb8-50"><a href="#cb8-50"></a>            <span class="cf">try</span>:</span>
<span id="cb8-51"><a href="#cb8-51"></a>                predictions <span class="op">=</span> <span class="va">self</span>.predictors_[value].predict(_X)</span>
<span id="cb8-52"><a href="#cb8-52"></a>            <span class="cf">except</span> <span class="pp">KeyError</span>:</span>
<span id="cb8-53"><a href="#cb8-53"></a>                <span class="co"># Fallback to the predictor for unknown categories.</span></span>
<span id="cb8-54"><a href="#cb8-54"></a>                predictions <span class="op">=</span> <span class="va">self</span>.unknown_predictor_.predict(_X)</span>
<span id="cb8-55"><a href="#cb8-55"></a></span>
<span id="cb8-56"><a href="#cb8-56"></a>            <span class="co"># Assign the prediction for this value to</span></span>
<span id="cb8-57"><a href="#cb8-57"></a>            <span class="co"># the corresponding indices in `rv`.</span></span>
<span id="cb8-58"><a href="#cb8-58"></a>            rv[is_value] <span class="op">=</span> predictions</span>
<span id="cb8-59"><a href="#cb8-59"></a>        <span class="cf">return</span> rv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we train and pray.</p>
<div id="3b62cfd4-2d7d-4bc9-9f19-dc08260f5adf" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Prepare the data for training again, focusing on the new feature.</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>features <span class="op">=</span> <span class="st">"length"</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>X <span class="op">=</span> train_df[features]</span>
<span id="cb9-4"><a href="#cb9-4"></a>test_df[<span class="st">"length"</span>] <span class="op">=</span> test_df[<span class="st">"review"</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span>
<span id="cb9-5"><a href="#cb9-5"></a>X_test <span class="op">=</span> test_df[features]</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co"># Train the model.</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>oner <span class="op">=</span> OneR().fit(X, y)</span>
<span id="cb9-9"><a href="#cb9-9"></a>oner.score(X_test, y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0.5026653102746694</code></pre>
</div>
</div>
<p>And the accuracy is still 50%. Bummer. Either our model isn’t good enough or our feature extraction doesn’t capture enough information from the reviews. In theory, our model will perform better if the feature is more informative, so next chapter we will look at improving our model by changing the features it’s trained on.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Holte1993" class="csl-entry" role="listitem">
Holte, Robert C. 1993. <span>“Very Simple Classification Rules Perform Well on Most Commonly Used Datasets.”</span> <em>Machine Learning</em> 11 (1): 63–90. <a href="https://doi.org/10.1023/A:1022631118932">https://doi.org/10.1023/A:1022631118932</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapter/02_baseline/baseline_classifier.html" class="pagination-link" aria-label="Baseline: gotta start somewhere">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Baseline: gotta start somewhere</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapter/04_boc/boc.html" class="pagination-link" aria-label="OneR, TwoR, RedR, BlueR: Inputs matter">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">OneR, TwoR, RedR, BlueR: Inputs matter</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>